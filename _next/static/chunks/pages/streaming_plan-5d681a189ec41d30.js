(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47],{4248:function(t,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/streaming_plan",function(){return n(4853)}])},4853:function(t,r,n){"use strict";n.r(r),n.d(r,{default:function(){return j}});var e=n(7568),a=n(4051),i=n.n(a),o=n(5893),l=n(2102),c=n(639),s=n(3234),u=n(7026),d=n(7098),f=n(9008),h=n.n(f),v=n(1163),g=n(7294),p=n(3812),m=n(9384);function x(t){var r=t.mvDependency,n=t.svgWidth,e=t.selectedId,a=t.onSelectedIdChange,i=(0,g.useRef)(),l=(0,g.useState)("0px"),c=l[0],s=l[1],u=(0,g.useCallback)((function(){var t=(0,d.zx)().nodeSize([10,34,5])(r);return{width:t.width,height:t.height,dag:r}}),[r]),f=u();return(0,g.useEffect)((function(){f.width;var t=f.height,r=f.dag,o=i.current,l=m.Ys(o),c=m.ak_,u=m.jvg().curve(c).x((function(t){return t.x+10})).y((function(t){return t.y})),d=function(t){return t.data.id===e},h=l.select(".edges").selectAll(".edge").data(r.links()),v=function(t){return t.attr("d",(function(t){var r=t.points;return u(r)})).attr("fill","none").attr("stroke-width",(function(t){return d(t.source)||d(t.target)?2:1})).attr("stroke",(function(t){return d(t.source)||d(t.target)?p.rS.colors.teal[500]:p.rS.colors.gray[300]}))};h.exit().remove(),h.enter().call((function(t){return t.append("path").attr("class","edge").call(v)})),h.call(v);var g=l.select(".nodes").selectAll(".node").data(r.descendants()),x=function(t){return t.attr("transform",(function(t){var r=t.x,n=t.y;return"translate(".concat(r+10,", ").concat(n,")")})).attr("fill",(function(t){return d(t)?p.rS.colors.teal[500]:p.rS.colors.gray[500]}))};g.exit().remove(),g.enter().call((function(t){return t.append("circle").attr("class","node").attr("r",5).call(x)})),g.call(x);var y=l.select(".labels").selectAll(".label").data(r.descendants()),S=function(t){return t.text((function(t){return t.data.name})).attr("x",n-10).attr("font-family","inherit").attr("text-anchor","end").attr("alignment-baseline","middle").attr("y",(function(t){return t.y})).attr("fill",(function(t){return d(t)?p.rS.colors.black[500]:p.rS.colors.gray[500]})).attr("font-weight","600")};y.exit().remove(),y.enter().call((function(t){return t.append("text").attr("class","label").call(S)})),y.call(S);var w=l.select(".overlays").selectAll(".overlay").data(r.descendants()),j=function(t){return t.attr("x",3).attr("height",24).attr("width",n-6).attr("y",(function(t){return t.y-5-12+2+3})).attr("rx",5).attr("fill",p.rS.colors.gray[500]).attr("opacity",0).style("cursor","pointer")};w.exit().remove(),w.enter().call((function(t){return t.append("rect").attr("class","overlay").call(j).on("mouseover",(function(t,r){m.Ys(this).transition().duration(parseInt(p.rS.transition.duration.normal)).attr("opacity",".10")})).on("mouseout",(function(t,r){m.Ys(this).transition().duration(parseInt(p.rS.transition.duration.normal)).attr("opacity","0")})).on("mousedown",(function(t,r){m.Ys(this).transition().duration(parseInt(p.rS.transition.duration.normal)).attr("opacity",".20")})).on("mouseup",(function(t,r){m.Ys(this).transition().duration(parseInt(p.rS.transition.duration.normal)).attr("opacity",".10")})).on("click",(function(t,r){a&&a(r.data.id)}))})),w.call(j),s("".concat(t,"px"))}),[r,e,n,a,f]),(0,o.jsxs)("svg",{ref:i,width:"".concat(n,"px"),height:c,children:[(0,o.jsx)("g",{className:"edges"}),(0,o.jsx)("g",{className:"nodes"}),(0,o.jsx)("g",{className:"labels"}),(0,o.jsx)("g",{className:"overlays"})]})}var y=n(5330),S=n(221);function w(t){var r=(0,g.useState)(),n=r[0],a=r[1],o=(0,l.pm)();return(0,g.useEffect)((function(){var r=function(){var r=(0,e.Z)(i().mark((function r(){var n;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,new AbortController,r.next=4,t();case 4:n=r.sent,a(n),r.next=12;break;case 8:r.prev=8,r.t0=r.catch(0),o({title:"Error Occurred",description:r.t0.toString(),status:"error",duration:5e3,isClosable:!0}),console.error(r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(){return r.apply(this,arguments)}}();r()}),[o,t]),{response:n}}function j(){var t=w(S.BA).response,r=w(S.jV).response,n=(0,g.useState)(),e=n[0],a=n[1],i=(0,v.useRouter)(),l=(0,g.useCallback)((function(){if(r&&i.query.id){var t=parseInt(i.query.id),n=r.find((function(r){return r.tableId===t}));if(n)return function(t){var r=function(r){var a=t.fragments[r],i=new Set,o=!0,l=!1,c=void 0;try{for(var s,u=a.actors[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var d=s.value,f=!0,h=!1,v=void 0;try{for(var g,p=d.upstreamActorId[Symbol.iterator]();!(f=(g=p.next()).done);f=!0){var m=g.value,x=e.get(m);x&&i.add(x)}}catch(y){h=!0,v=y}finally{try{f||null==p.return||p.return()}finally{if(h)throw v}}}}catch(y){l=!0,c=y}finally{try{o||null==u.return||u.return()}finally{if(l)throw c}}n.push({id:a.fragmentId.toString(),name:"Fragment ".concat(a.fragmentId),parentIds:Array.from(i).map((function(t){return t.toString()}))})},n=[],e=new Map;for(var a in t.fragments){var i=t.fragments[a],o=!0,l=!1,c=void 0;try{for(var s,u=i.actors[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var f=s.value;e.set(f.actorId,f.fragmentId)}}catch(v){l=!0,c=v}finally{try{o||null==u.return||u.return()}finally{if(l)throw c}}}for(var h in t.fragments)r(h);return(0,d.lu)()(n)}(n)}}),[r,i.query.id]);(0,g.useEffect)((function(){return t&&(i.query.id||t.length>0&&i.replace("?id=".concat(t[0].id))),function(){}}),[i,i.query.id,t]);var f=l(),p=(0,o.jsxs)(c.kC,{p:3,height:"100vh",flexDirection:"column",children:[(0,o.jsx)(y.Z,{children:"Streaming Plan"}),(0,o.jsxs)(c.kC,{flexDirection:"row",height:"100%",width:"full",children:[(0,o.jsxs)(c.gC,{mr:3,spacing:3,alignItems:"flex-start",width:200,children:[(0,o.jsxs)(s.NI,{children:[(0,o.jsx)(s.lX,{children:"Materialized View"}),(0,o.jsx)(u.Ph,{value:i.query.id,onChange:function(t){return i.replace("?id=".concat(t.target.value))},children:t&&t.filter((function(t){return!t.name.startsWith("__")})).map((function(t){return(0,o.jsxs)("option",{value:t.id,children:["(",t.id,") ",t.name]},t.name)}))})]}),(0,o.jsxs)(c.xu,{children:[(0,o.jsx)(c.xv,{fontWeight:"semibold",children:"Plan"}),f&&(0,o.jsx)(x,{svgWidth:200,mvDependency:f,onSelectedIdChange:function(t){return a(parseInt(t))},selectedId:null===e||void 0===e?void 0:e.toString()})]})]}),(0,o.jsx)(c.xu,{flex:1,height:"full",ml:3,children:(0,o.jsx)(c.xv,{fontWeight:"semibold",children:"Fragment Graph"})})]})]});return(0,o.jsxs)(g.Fragment,{children:[(0,o.jsx)(h(),{children:(0,o.jsx)("title",{children:"Streaming Fragments"})}),p]})}}},function(t){t.O(0,[474,98,160,282,774,888,179],(function(){return r=4248,t(t.s=r);var r}));var r=t.O();_N_E=r}]);